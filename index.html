<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTS PRO!</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/public/logod.png">
    <link rel="stylesheet" href="/public/style.css">
</head>
<body class="bg-dark text-white">
    <header class="bg text-white mx-1" style="background: transparent;">
        <div class="container">
            <h1 class="mt-3">PARALLEL TRACKING SENSE</h1>
            <marquee>TRACK YOUR EXPENSES...</marquee>
        </div>
    </header>

    <div class="container">
        <form id="expenseForm">
            <table class="table text-white">
                <tr><th>NAME</th><td><input type="text" class="form-control" id="name" required></td></tr>
                <tr><th>AMOUNT</th><td><input type="number" class="form-control" id="amount" required></td></tr>
                <tr><th>TYPES</th>
                    <td>
                        <select id="type" class="form-control" required>
                            <option value="">Choose one...</option>
                            <option value="Card">Card</option>
                            <option value="Cash">Cash</option>
                            <option value="Gpay/Paytm">Gpay/Paytm</option>
                            <option value="Other">Other</option>
                        </select>
                    </td>
                </tr>
                <tr><th>DESCRIPTION</th><td><input type="text" class="form-control" id="description" required></td></tr>
                <tr><th>DATE</th><td><input type="date" class="form-control" id="date" required></td></tr>
                <tr>
                    <td><button type="reset" class="btn btn-secondary">Clear</button></td>
                    <td><button type="submit" class="btn btn-primary">Confirm</button></td>
                </tr>
            </table>
        </form>

        <div id="tableContainer" class="mt-4"></div>
    </div>
<script>
// document.addEventListener("DOMContentLoaded", () => {
//     const form = document.querySelector("#expenseForm");
//     const container = document.querySelector("#tableContainer");

//     form.addEventListener("submit", async (e) => {
//         e.preventDefault();

//         const data = {
//             name: document.querySelector("#name").value.trim(),
//             amount: document.querySelector("#amount").value.trim(),
//             type: document.querySelector("#type").value,
//             description: document.querySelector("#description").value.trim(),
//             date: document.querySelector("#date").value
//         };

//         if (!data.name || !data.amount || !data.type || !data.description || !data.date) {
//             alert("Please fill all fields!");
//             return;
//         }

//         const response = await fetch("/submit", {
//             method: "POST",
//             headers: { "Content-Type": "application/json" },
//             body: JSON.stringify(data)
//         });

//         const result = await response.text();
//         alert(result);
//         form.reset();
//         loadData();
//     });

//     async function loadData() {
//         const res = await fetch("/users");
//         const users = await res.json();

//         let html = `
//         <table class="table table-striped text-white">
//             <thead><tr><th>Name</th><th>Amount</th><th>Type</th><th>Description</th><th>Date</th></tr></thead>
//             <tbody>
//         `;

//         users.forEach(u => {
//             html += `<tr><td>${u.name}</td><td>${u.amount}</td><td>${u.type}</td><td>${u.description}</td><td>${u.date}</td></tr>`;
//         });

//         html += "</tbody></table>";
//         container.innerHTML = html;
//     }

//     loadData();
// });

document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("#expenseForm");
    const container = document.querySelector("#tableContainer");
    let editingId = null; // To track which expense is being edited

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
            name: document.querySelector("#name").value.trim(),
            amount: document.querySelector("#amount").value.trim(),
            type: document.querySelector("#type").value,
            description: document.querySelector("#description").value.trim(),
            date: document.querySelector("#date").value
        };

        if (!data.name || !data.amount || !data.type || !data.description || !data.date) {
            alert("Please fill all fields!");
            return;
        }

        // ðŸ”¹ If editing an existing record
        if (editingId) {
            const res = await fetch(`/update/${editingId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            const msg = await res.text();
            alert(msg);
            editingId = null;
        } else {
            // ðŸ”¹ Create new record
            const response = await fetch("/submit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            const result = await response.text();
            alert(result);
        }

        form.reset();
        loadData();
    });

    async function loadData() {
        const res = await fetch("/users");
        const users = await res.json();

        let html = `
        <table class="table table-striped text-white">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
        `;

        users.forEach(u => {
            html += `
                <tr>
                    <td>${u.name}</td>
                    <td>${u.amount}</td>
                    <td>${u.type}</td>
                    <td>${u.description}</td>
                    <td>${u.date}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editExpense('${u._id}')">Edit</button>
                    </td>
                </tr>
            `;
        });

        html += "</tbody></table>";
        container.innerHTML = html;
    }

    // ðŸ”¹ Expose editExpense globally
    window.editExpense = async function(id) {
        const res = await fetch(`/user/${id}`);
        const user = await res.json();

        document.querySelector("#name").value = user.name;
        document.querySelector("#amount").value = user.amount;
        document.querySelector("#type").value = user.type;
        document.querySelector("#description").value = user.description;
        document.querySelector("#date").value = user.date;

        editingId = id; // Mark weâ€™re editing this record
    };

    loadData();
});




</script>
    <script src="server.js"></script>
</body>
</html>
